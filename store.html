<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Kurde Store - Apps</title>
    <style>
        :root { --ios-blue: #007aff; --ios-gray: #8e8e93; --ios-bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background-color: var(--ios-bg); margin: 0; padding-bottom: 50px; display: none; /* Hidden until security check passes */ }
        
        .header { background: white; padding: 40px 20px 20px; border-bottom: 1px solid #d1d1d6; }
        .header h1 { font-size: 34px; margin: 0; font-weight: 700; }
        .header p { color: var(--ios-gray); margin: 5px 0 0; font-size: 13px; }

        .search-container { padding: 15px; }
        .search-bar { width: 100%; padding: 12px; border-radius: 12px; border: none; background: #e3e3e8; font-size: 16px; outline: none; }

        .section-title { padding: 20px 20px 10px; font-size: 22px; font-weight: 700; }

        .app-list { background: white; margin: 0 15px; border-radius: 14px; padding: 0 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .app-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 0.5px solid #d1d1d6; }
        .app-item:last-child { border-bottom: none; }
        .app-icon { width: 60px; height: 60px; border-radius: 14px; margin-right: 15px; object-fit: cover; border: 0.5px solid #eee; }
        .app-info { flex-grow: 1; }
        .app-name { font-weight: 600; font-size: 17px; margin-bottom: 2px; }
        .app-sub { font-size: 13px; color: var(--ios-gray); }
        .get-btn { background: #f0f0f5; color: var(--ios-blue); padding: 6px 22px; border-radius: 20px; font-weight: 700; text-decoration: none; font-size: 14px; }
    </style>
</head>
<body>

    <div class="header">
        <p id="date-today"></p>
        <h1>Kurde Store</h1>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-bar" placeholder="Search Apps...">
    </div>

    <div class="section-title">Verified Apps</div>
    <div class="app-list" id="appList">
        <div class="app-item">
            <img src="https://is1-ssl.mzstatic.com/image/thumb/Purple122/v4/07/7e/39/077e390c-99c9-9404-5858-a53f090d8a59/AppIcon-512x512bb.jpg" class="app-icon">
            <div class="app-info">
                <div class="app-name">WhatsApp Watusi</div>
                <div class="app-sub">Premium Tweaks</div>
            </div>
            <a href="itms-services://?action=download-manifest&url=https://kurde.store/plist/whatsapp.plist" class="get-btn">GET</a>
        </div>
        
        <div class="app-item">
            <img src="https://is1-ssl.mzstatic.com/image/thumb/Purple122/v4/33/27/38/3327389c-091a-7e6e-028a-6b83f090d8a59/AppIcon-512x512bb.jpg" class="app-icon">
            <div class="app-info">
                <div class="app-name">Instagram Rocket</div>
                <div class="app-sub">Social Media+</div>
            </div>
            <a href="itms-services://?action=download-manifest&url=https://kurde.store/plist/instagram.plist" class="get-btn">GET</a>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const udid = urlParams.get('udid');

        // 1. SECURITY CHECK: Ensure user is Paid & 72h is passed
        async function verifyAccess() {
            if (!udid) {
                window.location.href = "index.html";
                return;
            }

            try {
                const response = await fetch(`https://api.kurde.store?udid=${udid}`);
                const data = await response.json();

                const seventyTwoHours = 72 * 60 * 60 * 1000;
                const now = Date.now();
                const timeLeft = seventyTwoHours - (now - data.reg_date);

                if (data.isPaid !== true || timeLeft > 0) {
                    // Kick back to status page if not authorized
                    window.location.href = `success.html?udid=${udid}`;
                } else {
                    // Access Granted
                    document.body.style.display = "block";
                    renderHeader();
                }
            } catch (err) {
                alert("Security error. Please refresh.");
            }
        }

        function renderHeader() {
            const options = { weekday: 'long', month: 'long', day: 'numeric' };
            document.getElementById('date-today').innerText = new Date().toLocaleDateString('en-US', options).toUpperCase();
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('keyup', function() {
            let filter = this.value.toLowerCase();
            let items = document.querySelectorAll('.app-item');
            items.forEach(item => {
                let text = item.querySelector('.app-name').innerText.toLowerCase();
                item.style.display = text.includes(filter) ? "flex" : "none";
            });
        });

        verifyAccess();
    </script>
</body>
</html>
