const urlParams = new URLSearchParams(window.location.search);
const udid = urlParams.get('udid');

async function checkStatus() {
    const response = await fetch(`https://api.kurde.store?udid=${udid}`);
    const data = await response.json();

    const statusDiv = document.getElementById('statusBox');
    const now = Date.now();
    const waitTime = 72 * 60 * 60 * 1000; // 72 hours in milliseconds

    if (data.status === "pending") {
        const timeLeft = waitTime - (now - data.reg_date);
        if (timeLeft > 0) {
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            statusDiv.innerHTML = `
                <div style="color: orange;">Status: Processing</div>
                <p>Apple is registering your device. Please wait <b>${hours} hours</b> more.</p>
                <p>The install button will appear once active.</p>
            `;
        } else {
            statusDiv.innerHTML = `
                <div style="color: green;">Status: Active</div>
                <a href="install-app.mobileconfig" class="btn">Install Kurde Store App</a>
            `;
        }
    }
}
checkStatus();
