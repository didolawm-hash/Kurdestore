<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kurde Store - Admin Panel</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #1c1c1e; color: white; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: #2c2c2e; padding: 30px; border-radius: 20px; border: 1px solid #3a3a3c; }
        h1 { font-size: 24px; margin-bottom: 20px; color: #0a84ff; }
        label { display: block; margin-top: 15px; color: #8e8e93; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border-radius: 10px; border: 1px solid #3a3a3c; background: #1c1c1e; color: white; box-sizing: border-box; }
        .btn-save { background: #30d158; color: white; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: bold; margin-top: 25px; cursor: pointer; }
        
        .manage-section { margin-top: 40px; border-top: 1px solid #3a3a3c; padding-top: 20px; }
        #adminSearch { margin-bottom: 20px; border: 1px solid #0a84ff; }
        
        .admin-item { display: flex; align-items: center; background: #1c1c1e; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 0.5px solid #3a3a3c; }
        .admin-item img { width: 45px; height: 45px; border-radius: 10px; margin-right: 15px; }
        .admin-item-info { flex-grow: 1; }
        .btn-delete { background: #ff3b30; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Add New App/Game</h1>
        <form id="appForm">
            <label>App Name</label>
            <input type="text" id="name" placeholder="e.g. Screen Mirror Pro" required>
            <div style="display:flex; gap:10px;">
                <div style="flex:1">
                    <label>Category</label>
                    <select id="category"><option value="Apps">Apps</option><option value="Games">Games</option></select>
                </div>
                <div style="flex:1"><label>Version</label><input type="text" id="version" placeholder="1.0.2"></div>
            </div>
            <label>Icon URL</label><input type="text" id="icon" placeholder="https://kurde.store/icon.png">
            <label>Plist URL</label><input type="text" id="ipa" placeholder="https://kurde.store/plist/app.plist" required>
            <label>Size (MB)</label><input type="number" id="size" placeholder="100">
            <label>Description</label><textarea id="desc" rows="3"></textarea>
            <button type="submit" class="btn-save">PUBLISH TO STORE</button>
        </form>

        <div class="manage-section">
            <h2>Manage Live Apps</h2>
            <input type="text" id="adminSearch" placeholder="Search live apps to delete...">
            <div id="admin-list">Loading apps...</div>
        </div>
    </div>

    <script>
        const API_URL = "https://wgcdclia51.execute-api.eu-west-2.amazonaws.com";

        // 1. ADD APP
        document.getElementById('appForm').onsubmit = async (e) => {
            e.preventDefault();
            const data = {
                name: document.getElementById('name').value,
                category: document.getElementById('category').value,
                version: document.getElementById('version').value,
                icon: document.getElementById('icon').value,
                ipa: document.getElementById('ipa').value,
                size: document.getElementById('size').value,
                desc: document.getElementById('desc').value
            };
            await fetch(`${API_URL}/add-app`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            alert("App Published Successfully!");
            document.getElementById('appForm').reset();
            loadAdminList();
        };

        // 2. LOAD LIST
        async function loadAdminList() {
            const listDiv = document.getElementById('admin-list');
            const res = await fetch(`${API_URL}/get-apps`);
            const items = await res.json();
            listDiv.innerHTML = '';
            items.forEach(item => {
                listDiv.innerHTML += `
                    <div class="admin-item">
                        <img src="${item.icon || 'https://kurde.store/assets/default-icon.png'}">
                        <div class="admin-item-info">
                            <div style="font-weight:bold">${item.name}</div>
                            <small style="color:gray">${item.category} â€¢ v${item.version}</small>
                        </div>
                        <button class="btn-delete" onclick="deleteApp('${item.appId}')">Delete</button>
                    </div>`;
            });
        }

        // 3. DELETE APP
        async function deleteApp(id) {
            if(!confirm("Are you sure? This will remove the app from the store.")) return;
            await fetch(`${API_URL}/delete-app`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id })
            });
            loadAdminList();
        }

        // 4. ADMIN SEARCH LOGIC
        document.getElementById('adminSearch').addEventListener('keyup', function() {
            let filter = this.value.toLowerCase();
            document.querySelectorAll('.admin-item').forEach(item => {
                let name = item.querySelector('.admin-item-info div').innerText.toLowerCase();
                item.style.display = name.includes(filter) ? "flex" : "none";
            });
        });

        loadAdminList();
    </script>
</body>
</html>
